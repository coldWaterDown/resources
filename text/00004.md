# Ветвление

Перейдем к не менее интересной теме - ветвление. Работая в команде, вы решайте множество различных задач и обычно для каждой задачи создается отдельная ветка в репозитории, что позволяет не вмешиваться в основную линию.

> Например: 
> 
> **Team Lead** дал вам новую задачу реализовать **компоненту рейтинга пользователей**, но данная фича по итогу может быть не введена в релиз (заказчик хочет посмотреть как будет выглядеть сервис и потом решит).
> 
> Параллельно вы делали задачу по **добавлению комментариев**. 
>
> Чтобы не мешать данные задачи (ведь одна может быть по итогу удалена из финальной версии), вы можете создать отдельную
> ветку для задачи с рейтингом.
>
> Еще один пример: [тут](https://git-scm.com/book/ru/v2/%D0%92%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-Git-%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B-%D0%B2%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B8-%D1%81%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D1%8F).

![alt-text](https://user-images.githubusercontent.com/4215285/51714893-ba303880-2047-11e9-9b65-d97398a0d382.jpeg)

Напомним, что **Git**:
- Хранит данные в виде снимков;
- При коммите сохраняет объект, который хранит указатель на предыдущие коммиты;
- Для каждого коммита и файла вычисляется контрольная сумма.

Ветка в **Git** по сути является указателем на коммит. 

Рассмотрим пример, который приводили выше. 

Допустим в **master** мы будем работать с задачей по **добавлению комментариев**, а задачу **компонент рейтинга пользователей** в ветке **rating**.

Инициализируем новый репозиторий:

`git init`
 
По умолчанию создается ветка **master**, которая является основной.

Добавим новый файл `main.md` и оставим запись `Основная страница проекта`.

Выполним стандартные команды и сделаем коммит:
```bash
git add .
git commit
```

![alt text](https://user-images.githubusercontent.com/4215285/51714887-b997a200-2047-11e9-8fa5-a6ac8dc422bd.jpeg)

По итогу указатель ветки **master** автоматически передвинется на него - **C1** (см. рисунок выше).

Выполним следующие действия:
- Добавим файл `comments.md` и оставим запись `Раздел с комментариями`;
- А в `main.md` добавим строку `Выводим содержимое comments.md`.

Снова сделаем коммит:
```bash
git add .
git commit
```

![alt text](https://user-images.githubusercontent.com/4215285/51714886-b8ff0b80-2047-11e9-86ad-0f4d9cea5ac6.jpeg)

Теперь указатель передвинулся на коммит **C2** (см. рисунок выше).

И тут нам приходит задача от Team Lead'а, который просит нас сделать рейтинг. Что ж, если мы будем делать данную задачу в ветке **master** и она по итогу не будет принята в финальную версию, нам придется самостоятельно возвращать все обратно.

![alt text](https://user-images.githubusercontent.com/4215285/51714885-b8ff0b80-2047-11e9-87ce-4523b7abd848.jpeg)

Поэтому мы создаем новую ветку с помощью команды:

`git branch rating`

![alt text](https://user-images.githubusercontent.com/4215285/51714884-b8ff0b80-2047-11e9-9b9c-b710a7724115.jpeg)
Как определить на какой мы ветке? Для этого есть специальный указатель - `HEAD`. С помощью команды `git checkout [ветка]` мы можем менять ветку и соответственно указатель `HEAD`:

`git checkout rating`

![alt text](https://user-images.githubusercontent.com/4215285/51714882-b8ff0b80-2047-11e9-8144-cd2802880021.jpeg)

В результате мы перешли на указанную ветку и поменяли `HEAD` (см. рисунок выше). 
Введем команду `git status` и увидим, что мы находимся в ветке **rating**.

Отлично. Теперь мы выполним следующие действия:
- Создадим файл `rating.md`, в котором пишем `Раздел с рейтингом`;
- Добавим в файл `main.md` строку `Ссылка на раздел с рейтингом`. 

![alt text](https://user-images.githubusercontent.com/4215285/51714880-b8667500-2047-11e9-80a1-6c1ab9c1cbc4.jpeg)
Сделаем коммит. По итогу указатель ветки **rating** передвинется на коммит **CR1**.

![alt text](https://user-images.githubusercontent.com/4215285/51714879-b8667500-2047-11e9-8c5e-6045e4880b73.jpeg)
Добавим новые изменения (на ваше усмотрение) в `rating.md` и создадим коммит **CR2**. В результате указатель **rating** и `HEAD` передвинуться на **CR2** (см. рисунок выше).

Итак, мы выполнили поставленную задачу. Вернемся обратно к ветке **master**:

`git checkout master`

![alt text](https://user-images.githubusercontent.com/4215285/51714878-b8667500-2047-11e9-951e-a26c2cbc882c.jpeg)

В результате указатель `HEAD` вернется к **master** и мы продолжим работу в основной ветке. 

![alt text](https://user-images.githubusercontent.com/4215285/51714877-b8667500-2047-11e9-8d7f-ab667b028a7b.jpeg)
Сделаем следующий коммит **C3** в ветке **master**. По итогу при каждом коммите указатели **master** и `HEAD` будут передвигаться вперед.

Больше информации о ветвлении [тут](https://git-scm.com/book/ru/v2/%D0%92%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-Git-%D0%9E-%D0%B2%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B2-%D0%B4%D0%B2%D1%83%D1%85-%D1%81%D0%BB%D0%BE%D0%B2%D0%B0%D1%85).

> Обычно в проектах для каждой задачи создаются отдельные ветки, что упрощает разработку.

## Решаем конфликты

По итогу наш заказчик все-таки решил добавить раздел рейтинга пользователей. Нам необходимо слить ветку **rating** в **master**!

![alt text](https://user-images.githubusercontent.com/4215285/51714876-b7cdde80-2047-11e9-83c6-8c2236b8257c.jpeg)

Для этого мы переходим в ветку **master** с помощью команды:

`git checkout master`

Теперь сольем ветку **rating** в **master**:

`git merge rating`

Так как у нас есть конфликты (изменения в одном и том же файле как в ветке **master**, так и в ветке **rating**), которые нельзя автоматически слить, то мы получим следующие строчки:

```bash
Auto-merging main.md
CONFLICT (content): Merge conflict in main.md
Automatic merge failed; fix conflicts and then commit the result.
```

Вам необходимо зайти в файл **main.md**, там будут несколько разделов:

```text
Основная страница проекта
Выводим содержимое comments.md
<<<<<<< HEAD
Изменения в C3
=======
Ссылка на раздел с комментариями
>>>>>>> rating
```

Верхняя часть с текущей ветки (**master**). Нижняя часть с ветки **rating**.
Решаем этот конфликт, оставив необходимый текст. Делаем `git add .`, `git commit`.

> На самом деле лучше использовать для решения конфликтов графический редактор.
> Например: Intellij Idea имеет встроенный conflict resolver.

## Итог

Мы рассмотрели основные понятия, связанные с системой контроля версий **Git**. Ваша задача изучить их более подробно, используя материалы на платформе [vectree](https://vectree.ru/vector/1/0).

За основу материала был взят [git-scm](https://git-scm.com/book/ru/v2/).
